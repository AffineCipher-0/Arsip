<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARSIP - MODE DEWA v9.1 (Dynamic UI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;500;800&display=swap');

        :root {
            --red-primary: #ff003c;
            --bg-black: #020202;
        }

        body {
            background-color: var(--bg-black);
            color: #d1d1d1;
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.02), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.02));
            background-size: 100% 4px, 4px 100%;
            z-index: 100;
            pointer-events: none;
        }

        .cyber-panel {
            background: rgba(10, 10, 10, 0.9);
            border: 1px solid rgba(255, 0, 60, 0.15);
            position: relative;
            backdrop-filter: blur(10px);
        }

        .corner {
            position: absolute;
            width: 10px; height: 10px;
            border: 2px solid var(--red-primary);
            z-index: 10;
        }
        .c-tl { top: -2px; left: -2px; border-right: 0; border-bottom: 0; }
        .c-tr { top: -2px; right: -2px; border-left: 0; border-bottom: 0; }
        .c-bl { bottom: -2px; left: -2px; border-right: 0; border-top: 0; }
        .c-br { bottom: -2px; right: -2px; border-left: 0; border-top: 0; }

        .glitch-text {
            text-transform: uppercase;
            font-weight: 900;
            letter-spacing: 4px;
            color: #fff;
            text-shadow: 2px 2px var(--red-primary);
        }

        .lyric-item {
            border-left: 2px solid #1a1a1a;
            padding: 8px 15px;
            transition: all 0.3s ease;
            opacity: 0.2;
        }

        .lyric-item.active {
            opacity: 1;
            border-color: var(--red-primary);
            background: linear-gradient(90deg, rgba(255, 0, 60, 0.15), transparent);
            transform: translateX(8px);
            color: #fff;
        }

        .console-line::before {
            content: ">> ";
            color: var(--red-primary);
        }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--red-primary); }

        .btn-glow:hover {
            box-shadow: 0 0 15px var(--red-primary);
            background: var(--red-primary);
            color: white;
        }
    </style>
</head>
<body class="p-4 md:p-6">

    <header class="flex justify-between items-end mb-6 border-b border-red-900/30 pb-4">
        <div>
            <div class="flex items-center gap-3 mb-2">
                <span class="text-[9px] px-2 py-1 border border-green-500 text-green-500 animate-pulse">OFFLINE_ENGINE_ACTIVE</span>
                <span id="api-status" class="text-[9px] px-2 py-1 border border-blue-500 text-blue-500">SYSTEM: NATIVE_VOICE</span>
            </div>
            <h1 class="glitch-text text-xl md:text-3xl">ARSIP<span class="text-zinc-500 text-xs md:text-sm font-light ml-3 italic">v9.1//DYNAMIC</span></h1>
        </div>
        <div class="text-right font-mono text-[10px] text-zinc-500">
            <div id="clock" class="text-red-500 font-bold">00:00:00</div>
        </div>
    </header>

    <main class="grid grid-cols-12 gap-4 flex-grow overflow-hidden">
        
        <section class="col-span-12 lg:col-span-4 flex flex-col gap-4 overflow-hidden">
            <div class="cyber-panel p-5 flex flex-col h-full overflow-hidden">
                <div class="c-tl corner"></div><div class="c-tr corner"></div>
                <div class="c-bl corner"></div><div class="c-br corner"></div>

                <label class="text-[10px] uppercase tracking-widest text-zinc-500 mb-2">Input Pesan</label>
                <textarea id="textInput" class="flex-grow bg-black/40 border border-zinc-800 p-4 text-sm focus:border-red-600 outline-none text-red-400 font-mono resize-none" placeholder="Ketik sesuatu..."></textarea>
                
                <div class="grid grid-cols-2 gap-4 mt-4">
                    <div class="space-y-1">
                        <label class="text-[9px] uppercase text-zinc-600">Pilih Suara</label>
                        <select id="voiceSelect" class="w-full bg-zinc-900 border border-zinc-800 text-[10px] p-2 outline-none text-zinc-300">
                        </select>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[9px] uppercase text-zinc-600">Speed: <span id="speedVal">1.0x</span></label>
                        <input type="range" id="speedSlider" min="0.5" max="2.0" step="0.1" value="1.0" class="w-full accent-red-600">
                    </div>
                </div>

                <button id="processBtn" class="mt-4 w-full bg-red-950/10 border border-red-600/50 hover:bg-red-600 hover:text-white py-3 font-black text-xs transition-all uppercase tracking-widest">
                    MULAI SINTESIS
                </button>
            </div>
        </section>

        <section class="col-span-12 lg:col-span-5 flex flex-col gap-4 overflow-hidden">
            <div class="cyber-panel p-5 flex-grow overflow-hidden flex flex-col">
                <div class="c-tl corner"></div><div class="c-tr corner"></div>
                <div class="c-bl corner"></div><div class="c-br corner"></div>

                <div id="lyricView" class="flex-grow overflow-y-auto space-y-2 pr-2">
                    <div class="h-full flex flex-col items-center justify-center opacity-20 text-center">
                        <span class="text-[10px] uppercase tracking-widest">Siap Menerima Data</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="col-span-12 lg:col-span-3 flex flex-col gap-4 overflow-hidden">
            <div class="cyber-panel p-4 h-1/2 flex flex-col">
                <canvas id="osc" class="w-full h-full bg-black/40 border border-zinc-900"></canvas>
            </div>
            <div class="cyber-panel p-4 h-1/2 flex flex-col overflow-hidden">
                <div id="consoleLog" class="flex-grow text-[9px] font-mono text-zinc-500 space-y-1 overflow-y-auto">
                    <div class="console-line">Sistem NATIVE aktif.</div>
                </div>
            </div>
        </section>
    </main>

    <footer class="mt-6 cyber-panel p-5 flex items-center gap-6">
        <button id="mainActionBtn" class="p-4 border border-red-600 text-red-600 rounded-full btn-glow transition-all">
            <svg id="btnIcon" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <!-- Play Icon Default -->
                <path d="M8 5v14l11-7z"/>
            </svg>
        </button>
        <div class="flex-grow">
            <div class="text-[10px] text-zinc-500 uppercase tracking-widest mb-1 font-bold">
                Status: <span id="statusLabel" class="text-red-500">IDLE</span>
            </div>
            <div class="h-1 bg-zinc-900 rounded-full overflow-hidden">
                <div id="progressBar" class="h-full bg-red-600 w-0 transition-all duration-300"></div>
            </div>
        </div>
    </footer>

    <script>
        const synth = window.speechSynthesis;
        let voices = [];
        let isSpeaking = false;
        let animationId = null;

        const ui = {
            input: document.getElementById('textInput'),
            btnProcess: document.getElementById('processBtn'),
            mainActionBtn: document.getElementById('mainActionBtn'),
            btnIcon: document.getElementById('btnIcon'),
            lyricView: document.getElementById('lyricView'),
            console: document.getElementById('consoleLog'),
            speedSlider: document.getElementById('speedSlider'),
            speedVal: document.getElementById('speedVal'),
            voiceSelect: document.getElementById('voiceSelect'),
            osc: document.getElementById('osc'),
            statusLabel: document.getElementById('statusLabel'),
            progressBar: document.getElementById('progressBar')
        };

        const ICONS = {
            play: '<path d="M8 5v14l11-7z"/>',
            stop: '<path d="M6 6h12v12H6z"/>'
        };

        function populateVoices() {
            voices = synth.getVoices();
            ui.voiceSelect.innerHTML = voices
                .map((v, i) => `<option value="${i}">${v.name} (${v.lang})</option>`)
                .join('');
        }

        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = populateVoices;
        }
        populateVoices();

        ui.speedSlider.oninput = () => ui.speedVal.innerText = ui.speedSlider.value + 'x';

        function pushLog(msg, color = "") {
            const d = document.createElement('div');
            d.className = "console-line " + color;
            d.innerText = msg;
            ui.console.appendChild(d);
            ui.console.scrollTop = ui.console.scrollHeight;
        }

        function updateUIState(speaking) {
            isSpeaking = speaking;
            if (speaking) {
                ui.btnIcon.innerHTML = ICONS.stop;
                ui.statusLabel.innerText = "SPEAKING";
                ui.statusLabel.classList.add('animate-pulse');
                drawVisualizer();
            } else {
                ui.btnIcon.innerHTML = ICONS.play;
                ui.statusLabel.innerText = "IDLE";
                ui.statusLabel.classList.remove('animate-pulse');
                ui.progressBar.style.width = '0%';
                if (animationId) cancelAnimationFrame(animationId);
                clearCanvas();
            }
        }

        function clearCanvas() {
            const ctx = ui.osc.getContext('2d');
            ctx.clearRect(0,0,ui.osc.width, ui.osc.height);
        }

        function speak() {
            if (synth.speaking) {
                synth.cancel();
                if (isSpeaking) {
                    updateUIState(false);
                    return;
                }
            }

            const text = ui.input.value.trim();
            if (!text) return pushLog("ERR: INPUT KOSONG");

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.voice = voices[ui.voiceSelect.value];
            utterance.rate = parseFloat(ui.speedSlider.value);

            const lines = text.split('\n').filter(l => l.trim());
            ui.lyricView.innerHTML = lines.map((t, i) => `<div class="lyric-item text-xs" id="line-${i}">${t}</div>`).join('');

            utterance.onstart = () => {
                updateUIState(true);
                pushLog("> Memulai output suara.");
            };

            utterance.onend = () => {
                updateUIState(false);
                pushLog("> Selesai.");
                document.querySelectorAll('.lyric-item').forEach(el => el.classList.remove('active'));
            };

            utterance.onerror = () => {
                updateUIState(false);
                pushLog("ERR: GAGAL MEMUTAR SUARA", "text-red-500");
            };

            utterance.onboundary = (event) => {
                if (event.name === 'word') {
                    const charIdx = event.charIndex;
                    const fullText = ui.input.value;
                    const progress = (charIdx / fullText.length) * 100;
                    ui.progressBar.style.width = progress + '%';

                    const beforeText = fullText.substring(0, charIdx);
                    const lineIdx = beforeText.split('\n').length - 1;
                    
                    document.querySelectorAll('.lyric-item').forEach((el, i) => {
                        el.classList.toggle('active', i === lineIdx);
                        if(i === lineIdx) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                }
            };

            synth.speak(utterance);
        }

        function drawVisualizer() {
            if (!isSpeaking) return;
            const ctx = ui.osc.getContext('2d');
            ctx.clearRect(0,0,ui.osc.width, ui.osc.height);
            
            const barCount = 40;
            const barWidth = ui.osc.width / barCount;
            
            ctx.fillStyle = '#ff003c';
            for(let i=0; i<barCount; i++) {
                // Random height simulated for native speech
                const h = Math.random() * ui.osc.height * 0.9;
                ctx.fillRect(i * barWidth, ui.osc.height, barWidth - 2, -h);
            }
            
            animationId = requestAnimationFrame(drawVisualizer);
        }

        ui.btnProcess.onclick = speak;
        ui.mainActionBtn.onclick = () => {
            if (isSpeaking) {
                synth.cancel();
                updateUIState(false);
                pushLog("> Dihentikan pengguna.");
            } else {
                speak();
            }
        };

        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString('id-ID', { hour12: false });
        }, 1000);
    </script>
</body>
</html>
